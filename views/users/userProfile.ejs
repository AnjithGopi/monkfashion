<%- include('../layouts/headerUser') -%>


    
    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" rel="nofollow">Home</a>
                    <span></span> Pages
                    <span></span> Account
                </div>
            </div>
        </div>
        <section class="pt-15 pb-15">
            <div class="container">
                <div class="row">
            
                    <div class="col-lg-10 ">
                        <div class="row">
                            <div class="col-md-4">

                                <div class="container mt-5 d-flex ">
                                   

                                    <div class="card p-3" style="width:400px; border-radius: 10px;">
                        
                                        <div class=" align-items-center">
                        
                                            <div class="image">
                                                 <img src="https://images.unsplash.com/photo-1522075469751-3a6694fb2f61?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=500&q=80" class="rounded" width="155" >
                                            </div>
                        
                                         <div class="ml-3 w-100">
                                            
                                           <h4 class="mb-0 mt-0"><%=user.name%></h4>
                                           <span><%=user.email %></span>
                    
                        
                                         </div>
                        
                                            
                                        </div>
                                        
                                    </div>
                                     
                                 </div>

                                <div class="dashboard-menu">
                                    <ul class="nav flex-column" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="false"><i class="fi-rs-settings-sliders mr-10"></i>Dashboard</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab" href="#account-detail" role="tab" aria-controls="account-detail" aria-selected="true"><i class="fi-rs-user mr-10"></i>Account details</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address" role="tab" aria-controls="address" aria-selected="true"><i class="fi-rs-marker mr-10"></i>My Address</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders" role="tab" aria-controls="orders" aria-selected="false"><i class="fi-rs-shopping-bag mr-10"></i>Orders</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#track-orders" role="tab" aria-controls="track-orders" aria-selected="false"><i class="fi-rs-shopping-cart-check mr-10"></i>Track Your Order</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="page-login-register.html"><i class="fi-rs-sign-out mr-10"></i>Logout</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="tab-content dashboard-content">
                                    <div class="tab-pane fade active show" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Hello <%=user.name%> </h5>
                                            </div>
                                            <div class="card-body">
                                                <p>From your account dashboard. you can easily check &amp; view your <a href="#">recent orders</a>, manage your <a href="#">shipping and billing addresses</a> and <a href="#">edit your password and account details.</a></p>
                                            </div>

                                            <% if(locals.error) { %>
                                            <div class="card-body">
                                              <h3>Error Occur at Backend !</h3>
                                                <h5><%= error %></h5>
                                            </div>
                                            <% } %>
                                          
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Your Orders</h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table">
                                                        <thead>
                                                            <tr>
                                                                <th>Order</th>
                                                                <th>Date</th>
                                                                <th>Status</th>
                                                                <th>Total</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>#1357</td>
                                                                <td>March 45, 2020</td>
                                                                <td>Processing</td>
                                                                <td>$125.00 for 2 item</td>
                                                                <td><a href="#" class="btn-small d-block">View</a></td>
                                                            </tr>
                                                            <tr>
                                                                <td>#2468</td>
                                                                <td>June 29, 2020</td>
                                                                <td>Completed</td>
                                                                <td>$364.00 for 5 item</td>
                                                                <td><a href="#" class="btn-small d-block">View</a></td>
                                                            </tr>
                                                            <tr>
                                                                <td>#2366</td>
                                                                <td>August 02, 2020</td>
                                                                <td>Completed</td>
                                                                <td>$280.00 for 3 item</td>
                                                                <td><a href="#" class="btn-small d-block">View</a></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="track-orders" role="tabpanel" aria-labelledby="track-orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Orders tracking</h5>
                                            </div>
                                            <div class="card-body contact-from-area">
                                                <p>To track your order please enter your OrderID in the box below and press "Track" button. This was given to you on your receipt and in the confirmation email you should have received.</p>
                                                <div class="row">
                                                    <div class="col-lg-8">
                                                        <form class="contact-form-style mt-30 mb-50" action="#" method="post">
                                                            <div class="input-style mb-20">
                                                                <label>Order ID</label>
                                                                <input name="order-id" placeholder="Found in your order confirmation email" type="text" class="square">
                                                            </div>
                                                            <div class="input-style mb-20">
                                                                <label>Billing email</label>
                                                                <input name="billing-email" placeholder="Email you used during checkout" type="email" class="square">
                                                            </div>
                                                            <button class="submit submit-auto-width" type="submit">Track</button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="address" role="tabpanel" aria-labelledby="address-tab">
                                        <div class="row">
                                            <div class="ship_detail ml-20">
                                                <div class="form-group">
                                                    <div class="chek-form">
                                                        <div class="custome-checkbox">
                                                            <input class="form-check-input" type="checkbox" name="checkbox" id="differentaddress" />
                                                            <label class="form-check-label label_info" data-bs-toggle="collapse"
                                                                data-target="#collapseAddress" href="#collapseAddress"
                                                                aria-controls="collapseAddress" for="differentaddress"><span
                                                                    class="text-success font-size-lg font-weight-bold">Add New
                                                                    address</span></label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div id="collapseAddress" class="different_address collapse in ml-10">
                                                    <form action="/home/profile/addAddress" method="post">
                                                        <div class="">
                                                            <label for="name">Name :</label>
                                                            <input type="text" required="" name="fname" placeholder="First name *" />
                                                        </div>
                                                        <div class="">
                                                            <label for="phoneNumber">Phone Number:</label>
                                                            <input type="tel" id="phone" name="phoneNumber" pattern="[0-9]{10}"
                                                                placeholder="Enter your phone number *" required />
                                                        </div>
                                                        <div class="">
                                                            <label for="altphoneNumber">Alternate Number:</label>
                                                            <input type="tel" id="phone2" name="phone2" pattern="[0-9]{10}"
                                                                placeholder="Alternate phone number" />
                                                        </div>
                                                        <div class="">
                                                            <label for="houseName">House Name</label>
                                                            <input required="" type="text" name="cname" placeholder="House no / Name" />
                                                        </div>
                            
                                                        <div class="">
                                                            <label for="city">City</label>
                                                            <input required="" type="text" name="city" placeholder="City / Town *" />
                                                        </div>
                                                        <div class="">
                                                            <label for="state">State</label>
                                                            <input required="" type="text" name="state" placeholder="State / County *" />
                                                        </div>
                                                        <div class="">
                                                            <label for="pincode">Pincode</label>
                                                            <input required="" type="text" name="pincode" pattern="[0-9]{6}"
                                                                placeholder="Postcode / ZIP *" />
                                                        </div>
                                                        <div class="">
                                                            <label for="LandMark">Land Mark</label>
                                                            <input type="text" name="landMark" placeholder="Add Land mark" />
                                                        </div>
                                                        <div class=" ml-10">
                                                            <button type="submit" onclick="validateForm()">
                                                                Add new address
                                                            </button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                            
                                            <% if(user.address.length > 0) { %>
                                            <% for (let i = 0 ; i < user.address.length ; i++ ) {%>
                                            <div class="col-lg-6" id="tableRow_<%=i%>">
                                                <div class="card">
                                                    <div class="card-header">
                                                        <h5 class="mb-0"> Address <%= i+1%></h5>
                                                    </div>
                                                    <div class="card-body">
                                                        <address><%= user.address[i].fullName %>
                                                          <br><%=user.address[i].houseName %> , <%= user.address[i].city %>,<%= user.address[i].state %><br><%= user.address[i].phone %> <br> <%= user.address[i].pincode %></br> </address>
                                                        <p></p>
                                                        <a href="/home/profile/editAddress?id=<%=user.address[i]._id %>&index=<%=i%>" class="btn-small">Edit</a>
                                                        <!-- <button type="button" class="btn btn-sm btn-danger delete-icon position-absolute bottom-0 end-0">
                                                            <i class="fi-rs-trash"></i>
                                                        </button> --> 
                                                        <a  class="text-muted position-absolute bottom-0 end-0 " onclick="removeAddress('<%= i%>')" ><i class="fi-rs-trash p-3"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                            <% } } else {%>
                                                <h3>No address available</h3>
                                                <% } %>

                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="account-detail" role="tabpanel" aria-labelledby="account-detail-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5>Account Detaills</h5>
                                            </div>
                                            <div class="card-body">
                                                <!-- <p>Already have an account? <a href="page-login-register.html">Log in instead!</a></p> -->
                                         
                                                    <div class="row">
                                                        <div class="form-group col-md-6">
                                                            <label> Name <span class="required">*</span></label>
                                                            <input required=" " value="<%= user.name %>" class="form-control square" name="name" type="text">
                                                        </div>
                                                        <!-- <div class="form-group col-md-6">
                                                            <label>Last Name <span class="required">*</span></label>
                                                            <input required="" class="form-control square" name="phone">
                                                        </div> -->
                                                        <!-- <div class="form-group col-md-12">
                                                            <label>Display Name <span class="required">*</span></label>
                                                            <input required=""  class="form-control square" name="dname" type="text">
                                                        </div> -->
                                                        <div class="form-group col-md-12">
                                                            <label>Email Address <span class="required">*</span></label>
                                                            <input required="" value= "<%= user.email %>" class="form-control square" name="email" type="email">
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>Mobile Number <span class="required">*</span></label>
                                                            <input required=""  value="<%= user.mobile %>" class="form-control square" name="password" type="tel">
                                                        </div>
                                                        <% if (user.address.length > 0) { %>
                                                        <div class="form-group col-md-12">
                                                            <label>Address <span class="required">*</span></label>
                                                            <div class="card">
                                                                <div class="card-header">
                                                                    <h5 class="mb-0">
                                                                        <%= user.address[0].fullName %>
                                                                    </h5>
                                                                </div>
                                                                <div class="card-body">
                                                                    <address>
                                                                        <%=user.address[0].houseName %> &nbsp; <%= user.address[0].city %>
                                                                                <%=user.address[0].state %> <br />
                                                                                    <%= user.address[0].pincode %>
                                                                                        <br />
                                                                                        <%=user.address[0].phone %>
                                                                    </address>
                                                                    <% if( user.address[0].landMark) { %>
                                                                        <p>
                                                                            <%= user.address[0].landMark %>
                                                                        </p>
                                                                        <% } %>
                                                                </div>
                                                            </div>                                                        </div>
                                                       
                                                            <% }  else {%>
                                                                <h3>No address available</h3>
                                                                <% } %>
                                                        <div class="col-md-12">
                                                            <!-- <button type="button"  class="btn btn-fill-out submit" name="submit" value="Submit">Save</button> -->
                                                            <a type="button" href="/home/profile/changePassword" class="btn btn-fill-out submit" name="submit" value="Submit">Change Password</a>
                                                            <a type="button" href="/home/profile/editProfile" class="btn btn-fill-out submit  position-absolute bottom-0 end-0 " name="submit" value="Submit">Update Profile</a>
                                                               
                                                        </div>
                                                    </div>
                                              
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    
    <%- include('../layouts/footerUser') -%>

     <!-- Toastr message -->

    <% if (locals.successMessage) { %>
        <script>
        toastr.success('<%=successMessage%>');
    </script>
    <% } %>
  
    <% if (locals.failedMessage) { %>
        <script>
        toastr.error('<%=failedMessage%>');
    </script>
    <% } %>

    <% if (locals.errorMessage) { %>
        <script>
        // toastr.error('<%=errorMessage%>');
        Swal.fire({
        title: 'Warning!',
        text: '<%=error%>' ,
        icon: 'warning',
        confirmButtonText: 'Okay'
    });
    </script>
    <% } %>

    


    <script>
        function validateForm() {
            // Reset error messages
            document.getElementById("nameError").textContent = "";
            document.getElementById("phoneError").textContent = "";

            // Get form values
            var name = document.forms["addressForm"]["fname"].value;
            var phone = document.forms["addressForm"]["phoneNumber"].value;

            // Validate name
            if (name.trim() === "") {
                document.getElementById("nameError").textContent = "Name is required.";
            }

            // Validate phone number
            if (!/^[0-9]{10}$/.test(phone)) {
                document.getElementById("phoneError").textContent =
                    "Please enter a valid phone number.";
            }

            // Add similar validation for other fields

            // If any error messages are present, prevent form submission
            if (
                document.getElementById("nameError").textContent ||
                document.getElementById("phoneError").textContent
            ) {
                event.preventDefault();
            }
        }

 // Function to remove address from user profile
    function removeAddress(index) {
        // Make a fetch request to the server to remove the item from the cart
        fetch(`/remove-address/${index}`, {
            method: 'DELETE',
        })
        .then(response => {
            console.log('response of remove address received')
            console.log(response)
            if (response.ok) {
            console.log('ok worked')
               
        toastr.success('Address removed successfully.');

                document.getElementById(`tableRow_${index}`).remove();
                updateTotal()
            } else {
                console.error('Failed to remove address.');
                 toastr.error('Failed to remove address.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
   

    </script>